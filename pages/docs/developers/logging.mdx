import Page from "@reason/pages/Docs";
export default Page({ title: "Daemon Logging" });

# Logging

Mina logs are located in the configuration directory located at `~/.coda-config`. This directory contains the following log files:

* `coda.log`. This file contains the latest logs of the daemon. Each log file is limited to 10 Mebibyte (MiB) in size and rotates though 50 log files. Rotated log files are named `coda.log.x` from `coda.log.0` to `coda.log.50`
* `mina-best-tip.log`. This file contains the best tip logs that make it easier to collect the required logs from nodes to determine the state to fork off of. This file is limited to 5 Mebibyte (MiB) in size and rotates a single log file `mina-best-tip.log.0`.
* `coda-prover.log`. Logs memory usage and batch size in prover. Limited to 128 MiB. Rotates through a single log file.
* `coda-verifier.log`. Logs memory usage and batch size in verifier 128 MiB. Rotates for a single log file.
* `coda.version` - This file contains the Git SHA of the running build.

### Log levels:

Mina's logs at the following levels, in this order of precendence, indicating the level of importance of the message.

* Spam
* Trace
* Debug
* Info
* Warn
* Error
* Fatal

<Alert>

Specifying a `log-level` of `Info` will only display messages from that log level and above and significantly reduce the verbosity of the logs.

</Alert>

### Log format:

The format of the logs is defined by the folowing structure. The `metadata` field contains additional information required for the log.

```
{
  "timestamp": timestamp,
  "level": level,
  "source": {
    "module": string,
    "location": string
  },
  "message": format_string,
  "metadata": {{...}}
}
```

### Exporting logs:

Mina provides a CLI tool to package up the log files from a node. This is also available via the GraphQL:

`export-logs` uses GraphQL which is why it dosn't work when stopped

For a running daemon the command is `coda client export-logs` where you can pass an option of `-tarfile` to specify the basename of the tar archive (default: date_time).

For a stopped daemon run `coda client export-local-logs` to export the local log files again passing the `tarfile` option to specify the output filename.

### Logging options:

The following options when starting the daemon affect the logging behaviour:

* `file-log-level` log level for the log file (default: Trace)
* `log-level`
* `log-format`
* `log-block-creation` Log the steps involved in including transactions and snark work in a block (default: true)
* `log-json` Print log output as JSON (default: plain text)
* `-log-received-blocks` Log blocks received from peers (default: false)
* `-log-snark-work-gossip` Log snark-pool diff received from peers (default: false)
* `-log-txn-pool-gossip` Log transaction-pool diff received from peers (default: false)

### Crash Reports:

When the deamon exits it will create a crash report. It will only maintain the last crash report. The filename will indicate the timestamp of the crash, 

`coda_crash_report_2020-11-26_11-24-51.750285`

This rport contain `coda_short_log` which is the last 4MiB of the logs. This file is zipped and contains the following files, if they exist:

* "coda_short.log" - system info and crash summary
* "registered_mask.dot" - ledger visualization
* "frontier.dot" - frontier visualization
* "coda_status.json"
* "crash_summary.json"
* "daemon.json" ]

<Alert>

You can upload the crash summary file directly to a GitHub issue.

</Alert>

Crash summary

    [ ("OS_type", `String Sys.os_type)
    ; ("Release", `String (Core.Unix.Utsname.release uname))
    ; ("Machine", `String (Core.Unix.Utsname.machine uname))
    ; ("Sys_name", `String (Core.Unix.Utsname.sysname uname))
    ; ("Exception", exn_json)
    ; ("Command", `String daemon_command)
    ; ("Coda_branch", `String Coda_version.branch)
    ; ("Coda_commit", `String Coda_version.commit_id) ]
    
    
    https://github.com/MinaProtocol/mina/issues/6799
    