import Page from "@reason/pages/Docs";
export default Page({ title: "Ledger App Mina" });


# ledger-app-mina

You can use your [Ledger Nano S](https://www.ledger.com/) hardware wallet to securely store your Mina private keys.

We are working on support for [Ledger Nano X](https://www.ledger.com/), but it is not yet completed.

The operations supported are
- Keypair generation
- Signing payment transactions
- Signing delegation transactions

We are in the process of an independent a security audit which has currently found no vulnerabilities, otherwise development is nearly completed. In the next week or so, we will be tweaking one constant related to signatures so that transactions cannot be replayed from a testnet to mainnet. Note that this does not affect key generation.

The app is not yet available for install through the Ledger Live user interface, but if you have a Nano S, you can sideload it onto your Ledger device by following the instructions below.

<Alert kind="warning">
We are currently wrapping up a security audit which has found no vulnerabilities, otherwise development is nearly completed.

Use at your own risk.  Make sure you have a backup of your Ledger's BIP39 secret
mnemonic phrase or use a separate Ledger device for testing this app.
</Alert>

## Installing on Ubuntu

Before installing please make sure your Ledger device is fully set up and configured.  In particular, make sure that Ledger's udev rules are installed.

If the udev rules are installed then `/etc/udev/rules.d/20-hw1.rules` will exist.  If this file is not present then you need to visit Ledger's website and follow the [Linux instructions for fixing connection issues](https://support.ledger.com/hc/en-us/articles/115005165269-Fix-connection-issues) or,
for advanced users, you can find the udev rules on the [LedgerHQ Github](https://github.com/LedgerHQ/udev-rules).

### 1) Install Python 3

```
$ sudo apt-get install python3
```

### 2) Install pip3

```
$ sudo apt-get install python3-pip
```

### 3) Install prerequisite libraries

```
sudo apt-get install libudev-dev libusb-1.0-0-dev python-dev virtualenv
```

### 4) Install Python tools for Ledger Blue, Nano S and Nano X

```
$ sudo pip3 install ledgerblue
```

### 5) Download ledger-app-mina

Download the [Latest Ledger App Mina Release](https://github.com/jspada/ledger-app-mina/releases/latest) from Github. We've currently tested version 1.0.0-beta.3

### 6) Extract the archive

```
$ tar xvzf ledger-app-mina-1.0.0-beta.3-0-g0680a71c.tar.gz
ledger-app-mina-1.0.0-beta.3-0-g0680a71c/README
ledger-app-mina-1.0.0-beta.3-0-g0680a71c/install.sh
ledger-app-mina-1.0.0-beta.3-0-g0680a71c/uninstall.sh
ledger-app-mina-1.0.0-beta.3-0-g0680a71c/mina_ledger_wallet
ledger-app-mina-1.0.0-beta.3-0-g0680a71c/bin/app.hex
```
### 7) Launch the installation script

```
$ cd ledger-app-mina-1.0.0-beta.3-0-g0680a71c
$ ./install.sh
Please unlock your Ledger device and exit any apps (press any key to continue)
Generated random root public key : b'04e95715d4813ab98c92833da9b169d3ff6ee11a4f94a465503cc91e77aaea688d45a0449f41bfaa2a1a789730e72d0ace759ca7c2b8a12e82c94cda61530cc363'
Using test master key b'04e95715d4813ab98c92833da9b169d3ff6ee11a4f94a465503cc91e77aaea688d45a0449f41bfaa2a1a789730e72d0ace759ca7c2b8a12e82c94cda61530cc363'
```

This will begin the installation of the app (continued in the next steps)

### 8) Allow the "unsafe manager"

Your Ledger device will warn you that the install script is an unsafe manager.

```
< X Deny unsafe manager >
```

Click left until you see

```
< ✓ Allow unsafe manager >
```

Select this option.

### 9) Install app Mina

Your Ledger device will ask if you want to install the Mina app.

```
< M Install app Mina >
```

Click left until you see

```
< ✓ Perform installation >
```

Select this option and enter your Ledger PIN code.

If the installation was successful the install script will terminate successfully and you will see the Mina logo among your list of installed apps.

### 10) Install the command-line wallet

```
$ sudo cp ./mina_ledger_wallet /usr/local/bin/
```

## Installing on Mac

### 1) Install Homebrew

```
$ /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
```

For more information please visit the [Homebrew website](https://brew.sh/)

### 2) Install python3

```
brew install python3
```

### 3) Install Python tools for Ledger Blue, Nano S and Nano X

```
$ pip3 install ledgerblue
```

### 4) Download ledger-app-mina

Download the [Latest Ledger App Mina Release](https://github.com/jspada/ledger-app-mina/releases/latest) from Github.

### 5) Extract the archive

```
$ tar xvzf ledger-app-mina-1.0.0-beta.3-0-g0680a71c.tar.gz
ledger-app-mina-1.0.0-beta.3-0-g0680a71c/README
ledger-app-mina-1.0.0-beta.3-0-g0680a71c/install.sh
ledger-app-mina-1.0.0-beta.3-0-g0680a71c/uninstall.sh
ledger-app-mina-1.0.0-beta.3-0-g0680a71c/mina_ledger_wallet
ledger-app-mina-1.0.0-beta.3-0-g0680a71c/bin/app.hex
```

### 6) Launch the installation script

```
$ cd ledger-app-mina-1.0.0-beta.3-0-g0680a71c
$ ./install.sh
Please unlock your Ledger device and exit any apps (press any key to continue)
Generated random root public key : b'04e95715d4813ab98c92833da9b169d3ff6ee11a4f94a465503cc91e77aaea688d45a0449f41bfaa2a1a789730e72d0ace759ca7c2b8a12e82c94cda61530cc363'
Using test master key b'04e95715d4813ab98c92833da9b169d3ff6ee11a4f94a465503cc91e77aaea688d45a0449f41bfaa2a1a789730e72d0ace759ca7c2b8a12e82c94cda61530cc363'
```

This will begin the installation of the app (continued in the next steps)

### 7) Allow the "unsafe manager"

Your Ledger device will warn you that the install script is an unsafe manager.

```
< X Deny unsafe manager >
```

Click left until you see

```
< ✓ Allow unsafe manager >
```

Select this option.

### 8) Install app Mina

Your Ledger device will ask if you want to install the Mina app.

```
< M Install app Mina >
```

Click left until you see

```
< ✓ Perform installation >
```

Select this option and enter your Ledger PIN code.

If the installation was successful the install script will terminate successfully and you will see the Mina logo among your list of installed apps.

### 9) Install the command-line wallet

```
$ sudo cp ./mina_ledger_wallet /usr/local/bin/
```

## Generating a keypair

To generate a keypair and obtain the associated Mina address, open the Mina app on your Ledger device and then on your terminal use `mina_ledger_wallet` command.

For example, to get the Mina address corresponding to hardware wallet account 42 (BIP44 account 44'/12586'/42'/0'/0') you would issue the following command.

```
$ mina_ledger_wallet get-address 42
```

You will be prompted to confirm

```
Get address for account 42 (path 44'/12586'/42'/0'/0')
Continue? (y/N) y
```

Once confirmed, you will see

```
Generating address (please confirm on Ledger device)...
```

on your terminal while the Ledger will display

```
Processing...
```

whilst it generates the keypair.

Since Mina uses new elliptic curves that are not yet supported in hardware, this process can take up to 47 seconds.

Once completed the Ledger will display the address for you to carefully check and confirm.

```
  Address (1/4)
B62qk2o9hqZRjAhG >
```

Once approved the `mina_ledger_wallet` command will output the result, which you can use.

```
Received address: B62qk2o9hqZRjAhG7skhWVXGtCfMdtqBvCTjVfYeh4mqLvrLmBQUmAY
```

(Note: your address 42 will be different than this one.)

## Validate your private key

Now that you've created your key -- you'll want to validate that it works. For this keypair, it suffices to verify that signed transactions coming out of the ledger are parsed correctly and that the signature verifies on Mina. You can do this using the `payment-validate` subcommand of the utils.py tool in the ledger.

Run the following command:

```
mina_ledger_wallet test-transaction 42 B62qnzbXmRNo9q32n4SNu2mpB8e7FYYLH8NmaX6oFCBYjjQ8SbD7uzV | coda advanced validate-transaction
```

Replace "B62q... " with your public key and 42 with your BIP44 account number. Warning: Make sure that your account_address is the one that corresponds to the account_number!


You'll need to go to your Ledger, check the transaction details and either "Accept" or "Reject".

If you reject, no test-transaction will be generated and this command will exit with an error.

If you accept, a test-transaction will be generated and you should see the following output:

```
Transaction was valid
All transactions were valid
```

